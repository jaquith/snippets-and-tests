// Declare global variables for Standard JS (linter)
/* global describe, it */
'use strict'

const chai = require('chai')
chai.use(require('dirty-chai')) // appease the linter
const stringFunctions = require('../helpers/stringFunctions.js')
const lowercaseQuerystringKeys = stringFunctions.getVanillaJsFile('code/limit-mappings-for-consent-events-adobe-analytics.js')

// declared outside of the tests so it can be shared among them
let exported

describe('the mappingLimiter functionality (template edit)', function () {
  it('should export without error', function () {
    const before = 'function limitMapping (u) {\n'
    const after = '\nreturn u.map\n}'
    exported = stringFunctions.exportNamedElements(lowercaseQuerystringKeys, ['limitMapping'], before, after)
  })


  it('should work correctly on a real example', function () {
    const u = {}
    u.map = {
      "legacy_adobeReportSuite": "s_account",
      "legacy_siteSubSection": "eVar1,prop1",
      "legacy_componentClicked": "eVar4,prop4",
      "legacy_queryStringParamVlid": "eVar5,prop5",
      "legacy_isAccommodationOnly": "eVar6",
      "legacy_queryStringParamQ": "eVar8,prop8",
      "legacy_bookingReference": "eVar11",
      "legacy_departureAirportCode": "eVar12,prop12",
      "legacy_epicCode": "eVar13,prop13",
      "legacy_departureDate": "eVar14,prop14",
      "legacy_roomComposition": "eVar16",
      "legacy_duration": "eVar17,eVar62,prop17,prop62",
      "legacy_price": "eVar18,prop18",
      "legacy_onlineDiscount": "eVar19,VALUE_event10",
      "legacy_limitedAvailabilityBeds": "eVar20",
      "legacy_dreamlinerFlight": "eVar21",
      "legacy_boardBasisCode": "eVar23,prop23",
      "legacy_productCollectionCode": "eVar24,prop24",
      "legacy_firstPartyAncillaries": "eVar25,prop25",
      "legacy_alternativeFlightOptions": "eVar26,prop26",
      "legacy_roomOrCabinType": "eVar27,prop27",
      "legacy_isLowDeposit": "eVar28",
      "legacy_minimumPaymentAmount": "eVar29",
      "legacy_flexibleDates": "eVar30",
      "_sm_6_25": "eVar41",
      "legacy_sessionID": "eVar42",
      "legacy_isCreditNoteIncentiveEligible": "eVar43",
      "legacy_pageID": "eVar45,prop45",
      "legacy_pageNameTemporary": "eVar46,prop46",
      "legacy_brand": "eVar48,prop48",
      "legacy_creditNoteCode": "eVar49",
      "legacy_numberOfAdults": "eVar51",
      "legacy_numberOfChildren": "eVar52",
      "legacy_numberOfInfants": "eVar53",
      "legacy_numberOfResults": "eVar54",
      "legacy_searchResultsFinalPosition": "eVar57",
      "legacy_cruiseEpicCode": "eVar61,prop61",
      "legacy_cruiseStayDuration": "eVar63,prop63",
      "legacy_cruiseStay": "eVar64",
      "legacy_cruiseShip": "eVar65,prop65",
      "legacy_cruiseType": "eVar66,prop66",
      "legacy_cruiseHotel": "eVar67",
      "legacy_flightType": "eVar68",
      "legacy_cruiseCabinType": "eVar69",
      "legacy_mmbAncillaries": "eVar70,prop70",
      "legacy_cruiseStayRoomType": "eVar71",
      "legacy_geoLevel": "eVar72,prop72",
      "legacy_flightExtrasBookingReference": "eVar80",
      "legacy_flightExtrasInboundDays": "eVar81",
      "legacy_flightExtrasCheckedInState": "eVar82",
      "legacy_programmeChangeMemoNotes": "eVar84",
      "legacy_mmbAmendmentDate": "eVar85",
      "legacy_filterCruiseCabin": "eVar87,prop7",
      "legacy_filterCruiseStayDuration": "eVar88",
      "legacy_filterCruiseShip": "eVar89,prop10",
      "legacy_filterCruiseDestination": "eVar90,prop11",
      "legacy_depositValueBookflow": "eVar91",
      "legacy_paymentType": "eVar92",
      "legacy_flightInventory": "eVar94",
      "legacy_carrierCode": "eVar95",
      "legacy_promoCodeName": "eVar96",
      "legacy_promoCodeValue": "eVar97",
      "legacy_filterAccommodationType": "eVar98,prop36",
      "legacy_filterBackTime": "eVar99,prop15",
      "legacy_filterBestFor": "eVar100,prop16",
      "legacy_filterBoard": "eVar101,prop19",
      "legacy_filterBudget": "eVar102,prop20",
      "legacy_filterDepartureAirport": "eVar103,prop21",
      "legacy_filterFeatures": "eVar104,prop22",
      "legacy_filterDestination": "eVar105,prop28",
      "legacy_filterHolidayType": "eVar106,prop29",
      "legacy_filterOutTime": "eVar107,prop30",
      "legacy_filterTuiRating": "eVar110,prop32",
      "legacy_filterTourOperator": "eVar111,prop33",
      "legacy_filterTripAdvisorRating": "eVar112,prop34",
      "legacy_limitedAvailabilitySeats": "eVar113",
      "legacy_sourceBookingReference": "eVar114",
      "legacy_sourceBookingSystem": "eVar115",
      "legacy_queryStringParamCmid": "eVar116,eVar154,prop75",
      "legacy_thirdPartyFlightDetail": "eVar117",
      "legacy_childAges": "eVar118,prop74",
      "legacy_tuiProductRating": "eVar119",
      "legacy_tripAdvisorRating": "eVar120",
      "legacy_commercialSortPriority": "eVar121",
      "legacy_programmeChangeIncentiveCode": "eVar122",
      "legacy_bookingOrMmbIncentiveCode": "eVar123",
      "legacy_programmeChangeFreeAmends": "eVar124",
      "legacy_commerceValueScore": "eVar125,eVar128",
      "legacy_customerID": "eVar130",
      "legacy_loginDetail": "eVar131",
      "legacy_durationSearched": "eVar132",
      "legacy_priceVariationAlert": "eVar135",
      "legacy_freeChildPlaces": "eVar155",
      "legacy_ppcVariant": "eVar156",
      "legacy_freeChildPlacePartySize": "eVar157",
      "legacy_filterFreeChildPlaces": "eVar158",
      "legacy_queryStringParamIto": "eVar161",
      "legacy_handLuggageOnly": "eVar162",
      "legacy_thirdPartyAncillaries": "eVar163,prop71",
      "legacy_filterSortBy": "eVar164,prop67",
      "legacy_depositOptionsAvailable": "eVar165",
      "legacy_depositOptionSelected": "eVar166",
      "legacy_flightOnlyDepositPeriod": "eVar167",
      "legacy_limitedAvailabilityCabins": "eVar168",
      "legacy_date": "eVar170",
      "legacy_airportExtras": "eVar171",
      "legacy_daysToDeparture": "eVar172",
      "legacy_roomAllocation": "eVar173",
      "legacy_mmbAmendmentType": "eVar174",
      "legacy_mmbBookingAmount": "eVar175",
      "legacy_mmbAmountOutstanding": "eVar176",
      "legacy_mmbBookingType": "eVar177",
      "legacy_mmbTransactionValue": "eVar178",
      "legacy_screenSizeIncludingIPhones": "eVar180",
      "legacy_mmbExistingBookingDepartureDate": "eVar181",
      "legacy_abTest": "eVar183",
      "legacy_hostname": "eVar184",
      "legacy_agentID": "eVar185",
      "legacy_abtaNumber": "eVar186",
      "legacy_retailVisitorIDValueChange": "eVar187",
      "legacy_thirdPartyBeds": "eVar188",
      "legacy_thirdPartyBedsSupplier": "eVar189",
      "legacy_sessionState": "eVar190",
      "legacy_gmpCustomerID": "eVar191",
      "legacy_cookieLength": "eVar192",
      "legacy_appVisitor": "eVar194",
      "legacy_customerAccountNumberOfBookings": "eVar195",
      "legacy_searchedDepartureDate": "eVar196",
      "legacy_departureDateDifference": "eVar197",
      "legacy_queryStringParamGclid": "eVar198",
      "legacy_directDebit": "eVar199",
      "legacy_preferredSearchAvailable": "eVar200",
      "legacy_searchedDestinationIDs": "eVar202",
      "legacy_arrivalAirportCode": "eVar206",
      "legacy_isChoiceSearch": "eVar207",
      "legacy_searchType": "eVar208",
      "legacy_Lock_Your_Price_Available": "eVar209",
      "cm_banner_version": "eVar210",
      "cm_optout_categories": "eVar211",
      "legacy_cancelReason": "eVar214",
      "legacy_filterCruiseStayDestination": "prop9",
      "legacy_filterSingleAccommodationEndState": "prop39",
      "legacy_shortlist": "prop40",
      "legacy_mmbAmendmentDetail": "prop41",
      "legacy_flightOnlyDeparturePeriod": "prop68",
      "_sm_6_146": "eVar38,prop38",
      "adobeChannel": "channel",
      "adobeCampaign": "campaign,eVar300",
      "_sm_6_149": "eVar74",
      "_sm_6_150": "eVar47",
      "numberOfPax": "VALUE_event8,eVar22",
      "_cprice": "PRODUCTS_price",
      "_cquan": "PRODUCTS_quantity",
      "_cprod": "PRODUCTS_id",
      "cm_event_name": "eVar211,linkName",
      "cm_method": "eVar212",
      "legacy_adobeProductString": "STATIC_PRODUCT_STRING",
      "_sm_6_158:true": "event107",
      "event:tiq.cm_manage_preferences": "event108",
      "event:tiq.cm_save_preferences": "event109",
      "_sm_6_160": "VALUE_event25",
      "_sm_6_160:1": "event26"
    }
    chai.expect(exported.limitMapping(u)).to.deep.equal({
      "legacy_adobeReportSuite": "s_account",
      "adobeChannel": "channel",
      "adobeCampaign": "campaign",
      "legacy_brand": "eVar48,prop48",
      "numberOfPax": "VALUE_event8",
      "cm_event_name": "eVar211,linkName",
      "cm_method": "eVar212",
      "_sm_6_158:true": "event107",
      "event:tiq.cm_manage_preferences": "event108",
      "event:tiq.cm_save_preferences": "event109",
      "_sm_6_160": "VALUE_event25",
      "_sm_6_160:1": "event26",
      "cm_banner_version": "eVar210",
      "cm_optout_categories": "eVar211",
    })
  })



})
